---
export interface Props {
  /**
   * ìˆœìœ„ ë²ˆí˜¸
   */
  rank?: number;
  /**
   * ì±… ì´ë¯¸ì§€ URL
   */
  image?: string;
  /**
   * ì±… ì œëª©
   */
  title: string;
  /**
   * ì €ìëª…
   */
  author: string;
  /**
   * ì´ë¯¸ì§€ í‘œì‹œ ì—¬ë¶€
   */
  hasImage?: boolean;
  /**
   * ì¢‹ì•„ìš” ìƒíƒœ
   */
  isLiked?: boolean;
  /**
   * ì¶”ê°€ CSS í´ë˜ìŠ¤
   */
  class?: string;
}

const { rank, image, title, author, hasImage = true, isLiked = false, class: className = '', ...rest } = Astro.props;

const cardClasses = ['book-list-card', className].filter(Boolean).join(' ');
---

<div class={cardClasses} {...rest} role="button">
  {
    rank && (
      <div class="book-rank">
        <span class="tx-rank">{rank}</span>
      </div>
    )
  }

  {
    hasImage && image ? (
      <div class="book-image-container">
        <img src={image} alt={title} class="book-image" />
      </div>
    ) : (
      <div class="book-placeholder">
        <div class="book-icon">ğŸ“–</div>
        <p class="placeholder-text">ì±…í‘œì§€ ìƒí’ˆì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤</p>
      </div>
    )
  }

  <button class={`like-btn ${isLiked ? 'liked' : ''}`}>â™¡ ë‚´ì±…ì¥ë‹´ê¸°</button>

  <div class="book-info">
    <h4 class="book-title">{title}</h4>
    <p class="book-author">{author}</p>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.like-btn').forEach(btn => {
      btn.addEventListener('click', e => {
        e.preventDefault();
        e.stopPropagation();
        e.target.classList.toggle('liked');
        console.log('ì±… ë‹´ê¸°/ë¹¼ê¸°');

        // ì»¤ìŠ¤í…€ ì´ë²¤íŠ¸ ë°œìƒ
        const bookCard = e.target.closest('.book-card');
        bookCard.dispatchEvent(
          new CustomEvent('bookLikeToggle', {
            detail: {
              isLiked: e.target.classList.contains('liked'),
              title: bookCard.querySelector('.book-title').textContent,
            },
          })
        );
      });
    });
  });
</script>
