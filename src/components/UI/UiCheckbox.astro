---
export interface Props {
  name?: string;
  value?: string;
  checked?: boolean;
  disabled?: boolean;
  indeterminate?: boolean;
  size?: 'small' | 'medium' | 'large';
  variant?: 'default' | 'filled' | 'outlined';
  state?: 'default' | 'success' | 'error' | 'warning';
  label?: string;
  helperText?: string;
  errorMessage?: string;
  id?: string;
  class?: string;
}

const {
  name,
  value,
  checked = false,
  disabled = false,
  indeterminate = false,
  size = 'medium',
  variant = 'default',
  state = 'default',
  label,
  helperText,
  errorMessage,
  id,
  class: className = '',
} = Astro.props;

const checkboxId = id || `checkbox-${Math.random().toString(36).substr(2, 9)}`;
const hasLabel = label && label.length > 0;
const hasHelperText = helperText && helperText.length > 0;
const hasErrorMessage = errorMessage && errorMessage.length > 0;
const isError = state === 'error';

const checkboxClasses = [
  'ui-checkbox',
  `ui-checkbox--${size}`,
  `ui-checkbox--${variant}`,
  `ui-checkbox--${state}`,
  disabled ? 'ui-checkbox--disabled' : '',
  indeterminate ? 'ui-checkbox--indeterminate' : '',
  className,
]
  .filter(Boolean)
  .join(' ');
---

<div class="ui-checkbox-container">
  <!-- 전체 영역을 label로 감싸서 어디든 클릭 가능하게 -->
  <label for={checkboxId} class={checkboxClasses}>
    <div class="ui-checkbox__item">
      <input
        type="checkbox"
        id={checkboxId}
        name={name}
        value={value}
        checked={checked}
        disabled={disabled}
        class="ui-checkbox__input"
        aria-invalid={isError}
        aria-describedby={hasHelperText || hasErrorMessage
          ? `${checkboxId}-help`
          : undefined}
      />
      <div class="ui-checkbox__control">
        <div class="ui-checkbox__checkmark">
          <svg viewBox="0 0 16 12" class="ui-checkbox__check-icon">
            <path
              d="M1 6L5.5 10.5L15 1"
              stroke="currentColor"
              stroke-width="2"
              fill="none"></path>
          </svg>
          <div class="ui-checkbox__indeterminate-icon"></div>
        </div>
      </div>
    </div>

    {
      hasLabel && (
        <span class="ui-checkbox__label">
          <span class="ui-checkbox__title">{label}</span>
        </span>
      )
    }
  </label>

  {
    (hasHelperText || hasErrorMessage) && (
      <div id={`${checkboxId}-help`} class="ui-checkbox__help">
        {isError && hasErrorMessage ? errorMessage : helperText}
      </div>
    )
  }
</div>
