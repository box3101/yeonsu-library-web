---
/**
 * MobileMenu 컴포넌트
 * 모바일 환경에서 사용되는 햄버거 메뉴
 * 새로운 메뉴 구조 데이터를 import하여 사용
 */
import { menuConfig, isExternalLink } from '../../../src/data/menuData';

// 모바일 메뉴에서 표시할 메뉴 카테고리들 (회원서비스, 기타 제외)
const menuCategories = [
	'도서검색',
	'책 읽는 연수구',
	'안내마당',
	'도서서비스',
	'열린참여마당',
	'문화마당',
	'도서관소개',
	'나의도서관',
];

// 모바일 메뉴 전용 데이터 구조 (Vanilla JS 방식)
// MobileMenuItem: { title: string, url?: string, children?: MobileMenuItem[] }
// MobileMenuSection: { title: string, children: MobileMenuItem[] }

// 메뉴 데이터를 모바일 메뉴 형태로 변환하는 함수
function convertToMobileFormat(menuKey) {
	const menu = menuConfig[menuKey];
	if (!menu) return [];

	return [
		{
			title: menu.title,
			children: menu.sections.map(section => {
				const mobileItem = {
					title: section.title,
					url: section.href,
					isExternal: isExternalLink(section.href || '', section.isExternal), // 외부 링크 여부 추가
				};

				// 3depth 메뉴가 있는 경우 children으로 추가
				if (section.items && section.items.length > 0) {
					mobileItem.children = section.items.map(item => ({
						title: item.label,
						url: item.href,
						isExternal: isExternalLink(item.href, item.isExternal), // 3depth에서도 외부 링크 지원
					}));
				}

				return mobileItem;
			}),
		},
	];
}

// 각 카테고리별 모바일 메뉴 데이터 생성
const menuData = {};
menuCategories.forEach(category => {
	menuData[category] = convertToMobileFormat(category);
});
---

<!-- 모바일 메뉴 오버레이 -->
<div class="mobile-menu-overlay" id="mobileMenuOverlay"></div>

<!-- 모바일 메뉴 -->
<div class="mobile-menu" id="mobileMenu">
	<!-- 모바일 메뉴 헤더 -->
	<div class="mobile-menu-header">
		<!-- 유틸리티 영역 -->
		<div class="mobile-menu-utility">
			<button type="button" class="mobile-menu-close" id="mobileMenuClose" aria-label="메뉴 닫기">
				<img src="./assets/images/icon/icon-close.svg" class="icon icon-close" />
			</button>
		</div>

		<!-- 다국어 번역 -->
		<div class="lang-wrap">
			<!-- 기타언어 번역 -->
			<div class="lang langBox Other_lang">
				<button type="button" class="ctrl-tnb open" onclick="$('.langBox').toggleClass('on');">
					<span>기타언어 번역</span>
					<span class="hidden">목록 열기</span>
				</button>
				<ul>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('af');" title="Afrikaans"><span>Afrikaans</span></a>
					</li>
					<li><a href="javascript:void(0);" onclick="setPageLang('am');" title="አማርኛ"><span>አማርኛ</span></a></li>
					<li><a href="javascript:void(0);" onclick="setPageLang('ar');" title="العربية"><span>العربية</span></a></li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('az');" title="azərbaycan dili">
							<span>azərbaycan dili</span>
						</a>
					</li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('be');" title="беларуская"><span>беларуская</span></a>
					</li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('bg');" title="български"><span>български</span></a>
					</li>
					<li><a href="javascript:void(0);" onclick="setPageLang('bn');" title="বাংলা"><span>বাংলা</span></a></li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('bs');" title="bosanski"><span>bosanski</span></a>
					</li>
					<li><a href="javascript:void(0);" onclick="setPageLang('ca');" title="català"><span>català</span></a></li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('ceb');" title="Cebuano"><span>Cebuano</span></a>
					</li>
					<li><a href="javascript:void(0);" onclick="setPageLang('cs');" title="čeština"><span>čeština</span></a></li>
					<li><a href="javascript:void(0);" onclick="setPageLang('cy');" title="Cymraeg"><span>Cymraeg</span></a></li>
					<li><a href="javascript:void(0);" onclick="setPageLang('da');" title="dansk"><span>dansk</span></a></li>
					<li><a href="javascript:void(0);" onclick="setPageLang('de');" title="Deutsch"><span>Deutsch</span></a></li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('el');" title="Ελληνικά"><span>Ελληνικά</span></a>
					</li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('eo');" title="Esperanto"><span>Esperanto</span></a>
					</li>
					<li><a href="javascript:void(0);" onclick="setPageLang('es');" title="español"><span>español</span></a></li>
					<li><a href="javascript:void(0);" onclick="setPageLang('et');" title="eesti"><span>eesti</span></a></li>
					<li><a href="javascript:void(0);" onclick="setPageLang('eu');" title="euskara"><span>euskara</span></a></li>
					<li><a href="javascript:void(0);" onclick="setPageLang('fa');" title="فارسی"><span>فارسی</span></a></li>
					<li><a href="javascript:void(0);" onclick="setPageLang('fi');" title="suomi"><span>suomi</span></a></li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('fil');" title="Filipino"><span>Filipino</span></a>
					</li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('fr');" title="français"><span>français</span></a>
					</li>
					<li><a href="javascript:void(0);" onclick="setPageLang('fy');" title="Frysk"><span>Frysk</span></a></li>
					<li><a href="javascript:void(0);" onclick="setPageLang('ga');" title="Gaeilge"><span>Gaeilge</span></a></li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('gd');" title="Gàidhlig"><span>Gàidhlig</span></a>
					</li>
					<li><a href="javascript:void(0);" onclick="setPageLang('gl');" title="galego"><span>galego</span></a></li>
					<li><a href="javascript:void(0);" onclick="setPageLang('gu');" title="ગુજરાતી"><span>ગુજરાતી</span></a></li>
					<li><a href="javascript:void(0);" onclick="setPageLang('ha');" title="Hausa"><span>Hausa</span></a></li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('haw');" title="ʻŌlelo Hawaiʻi">
							<span>ʻŌlelo Hawaiʻi</span>
						</a>
					</li>
					<li><a href="javascript:void(0);" onclick="setPageLang('he');" title="עברית"><span>עברית</span></a></li>
					<li><a href="javascript:void(0);" onclick="setPageLang('hi');" title="हिन्दी"><span>हिन्दी</span></a></li>
					<li><a href="javascript:void(0);" onclick="setPageLang('hmn');" title="Hmong"><span>Hmong</span></a></li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('hr');" title="hrvatski"><span>hrvatski</span></a>
					</li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('ht');" title="Kreyòl ayisyen">
							<span>Kreyòl ayisyen</span>
						</a>
					</li>
					<li><a href="javascript:void(0);" onclick="setPageLang('hu');" title="magyar"><span>magyar</span></a></li>
					<li><a href="javascript:void(0);" onclick="setPageLang('hy');" title="հայերեն"><span>հայերեն</span></a></li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('id');" title="Bahasa Indonesia">
							<span>Bahasa Indonesia</span>
						</a>
					</li>
					<li><a href="javascript:void(0);" onclick="setPageLang('ig');" title="Igbo"><span>Igbo</span></a></li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('is');" title="íslenska"><span>íslenska</span></a>
					</li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('it');" title="italiano"><span>italiano</span></a>
					</li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('jv');" title="basa Jawa"><span>basa Jawa</span></a>
					</li>
					<li><a href="javascript:void(0);" onclick="setPageLang('ka');" title="ქართული"><span>ქართული</span></a></li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('kk');" title="қазақ тілі"><span>қазақ тілі</span></a>
					</li>
					<li><a href="javascript:void(0);" onclick="setPageLang('km');" title="ខ្មែរ"><span>ខ្មែរ</span></a></li>
					<li><a href="javascript:void(0);" onclick="setPageLang('kn');" title="ಕನ್ನಡ"><span>ಕನ್ನಡ</span></a></li>
					<li><a href="javascript:void(0);" onclick="setPageLang('ku');" title="Kurdî"><span>Kurdî</span></a></li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('ky');" title="кыргызча"><span>кыргызча</span></a>
					</li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('lb');" title="Lëtzebuergesch">
							<span>Lëtzebuergesch</span>
						</a>
					</li>
					<li><a href="javascript:void(0);" onclick="setPageLang('la');" title="Latina"><span>Latina</span></a></li>
					<li><a href="javascript:void(0);" onclick="setPageLang('lo');" title="ລາວ"><span>ລາວ</span></a></li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('lt');" title="lietuvių"><span>lietuvių</span></a>
					</li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('lv');" title="latviešu"><span>latviešu</span></a>
					</li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('mg');" title="Malagasy"><span>Malagasy</span></a>
					</li>
					<li><a href="javascript:void(0);" onclick="setPageLang('mi');" title="Māori"><span>Māori</span></a></li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('mk');" title="македонски"><span>македонски</span></a>
					</li>
					<li><a href="javascript:void(0);" onclick="setPageLang('ml');" title="മലയാളം"><span>മലയാളം</span></a></li>
					<li><a href="javascript:void(0);" onclick="setPageLang('mr');" title="मराठी"><span>मराठी</span></a></li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('ms');" title="Bahasa Melayu">
							<span>Bahasa Melayu</span>
						</a>
					</li>
					<li><a href="javascript:void(0);" onclick="setPageLang('mt');" title="Malti"><span>Malti</span></a></li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('nl');" title="Nederlands"><span>Nederlands</span></a>
					</li>
					<li><a href="javascript:void(0);" onclick="setPageLang('no');" title="norsk"><span>norsk</span></a></li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('ny');" title="Chichewa"><span>Chichewa</span></a>
					</li>
					<li><a href="javascript:void(0);" onclick="setPageLang('pa');" title="ਪੰਜਾਬੀ"><span>ਪੰਜਾਬੀ</span></a></li>
					<li><a href="javascript:void(0);" onclick="setPageLang('pl');" title="polski"><span>polski</span></a></li>
					<li><a href="javascript:void(0);" onclick="setPageLang('ps');" title="پښتو"><span>پښتو</span></a></li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('pt');" title="português"><span>português</span></a>
					</li>
					<li><a href="javascript:void(0);" onclick="setPageLang('ro');" title="română"><span>română</span></a></li>
					<li><a href="javascript:void(0);" onclick="setPageLang('ru');" title="русский"><span>русский</span></a></li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('rw');" title="Kinyarwanda">
							<span>Kinyarwanda</span>
						</a>
					</li>
					<li><a href="javascript:void(0);" onclick="setPageLang('sd');" title="سنڌي"><span>سنڌي</span></a></li>
					<li><a href="javascript:void(0);" onclick="setPageLang('si');" title="සිංහල"><span>සිංහල</span></a></li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('sk');" title="slovenčina"><span>slovenčina</span></a>
					</li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('sl');" title="slovenščina">
							<span>slovenščina</span>
						</a>
					</li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('sm');" title="Gagana Samoa">
							<span>Gagana Samoa</span>
						</a>
					</li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('sn');" title="chiShona"><span>chiShona</span></a>
					</li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('so');" title="Soomaali"><span>Soomaali</span></a>
					</li>
					<li><a href="javascript:void(0);" onclick="setPageLang('sq');" title="shqip"><span>shqip</span></a></li>
					<li><a href="javascript:void(0);" onclick="setPageLang('sr');" title="српски"><span>српски</span></a></li>
					<li><a href="javascript:void(0);" onclick="setPageLang('st');" title="Sesotho"><span>Sesotho</span></a></li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('su');" title="Basa Sunda"><span>Basa Sunda</span></a>
					</li>
					<li><a href="javascript:void(0);" onclick="setPageLang('sv');" title="svenska"><span>svenska</span></a></li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('sw');" title="Kiswahili"><span>Kiswahili</span></a>
					</li>
					<li><a href="javascript:void(0);" onclick="setPageLang('ta');" title="தமிழ்"><span>தமிழ்</span></a></li>
					<li><a href="javascript:void(0);" onclick="setPageLang('te');" title="తెలుగు"><span>తెలుగు</span></a></li>
					<li><a href="javascript:void(0);" onclick="setPageLang('tg');" title="тоҷикӣ"><span>тоҷикӣ</span></a></li>
					<li><a href="javascript:void(0);" onclick="setPageLang('tr');" title="Türkçe"><span>Türkçe</span></a></li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('uk');" title="українська"><span>українська</span></a>
					</li>
					<li><a href="javascript:void(0);" onclick="setPageLang('ur');" title="اردو"><span>اردو</span></a></li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('xh');" title="isiXhosa"><span>isiXhosa</span></a>
					</li>
					<li><a href="javascript:void(0);" onclick="setPageLang('yi');" title="ייִדיש"><span>ייִדיש</span></a></li>
					<li><a href="javascript:void(0);" onclick="setPageLang('yo');" title="Yorùbá"><span>Yorùbá</span></a></li>
					<li><a href="javascript:void(0);" onclick="setPageLang('zu');" title="isiZulu"><span>isiZulu</span></a></li>
				</ul>
				<button
					type="button"
					class="ctrl-tnb close"
					onclick="$('.langBox').removeClass('on'); $('.langBox .open').focus();"
				>
					기타언어 번역
				</button>
			</div>

			<!-- 다국어 번역 (주요 언어) -->
			<div class="lang infoBox">
				<button type="button" class="ctrl-tnb infoBox open" onclick="$('.infoBox').toggleClass('on');">
					<span>다국어 번역</span>
					<span class="hidden">목록 열기</span>
				</button>
				<ul>
					<li><a href="javascript:void(0);" onclick="setPageLang('ko');" title="한국어"><span>한국어</span></a></li>
					<li><a href="javascript:void(0);" onclick="setPageLang('en');" title="english"><span>english</span></a></li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('zh-CN');" title="简体中文"><span>简体中文</span></a>
					</li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('zh-TW');" title="繁体中文"><span>繁体中文</span></a>
					</li>
					<li><a href="javascript:void(0);" onclick="setPageLang('ja');" title="日本語"><span>日本語</span></a></li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('vi');" title="tiếng Việt"><span>tiếng Việt</span></a>
					</li>
					<li><a href="javascript:void(0);" onclick="setPageLang('mn');" title="Монгол"><span>Монгол</span></a></li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('tl');" title="Filipino"><span>Filipino</span></a>
					</li>
					<li><a href="javascript:void(0);" onclick="setPageLang('my');" title="မြန်မာ"><span>မြန်မာ</span></a></li>
					<li><a href="javascript:void(0);" onclick="setPageLang('ne');" title="नेपाली"><span>नेपाली</span></a></li>
					<li><a href="javascript:void(0);" onclick="setPageLang('th');" title="แบบไทย"><span>แบบไทย</span></a></li>
					<li>
						<a href="javascript:void(0);" onclick="setPageLang('uz');" title="o'zbek tili">
							<span>o'zbek tili</span>
						</a>
					</li>
				</ul>
				<button
					type="button"
					class="ctrl-tnb info-box close"
					onclick="$('.infoBox').removeClass('on'); $('.infoBox .open').focus();"
				>
					다국어 번역 목록 닫기
				</button>
			</div>
		</div>
		<!-- // 다국어 번역 -->

		<!-- 유틸리티 링크 (회원가입, 로그인, English, 사이트맵) -->
		<div class="mobile-menu-links">
			<a href="#" class="mobile-menu-link">
				<img src="./assets/images/icon/icon-person.svg" class="icon icon-person" />
				<span>회원가입</span>
			</a>
			<a href="#" class="mobile-menu-link">
				<img src="./assets/images/icon/icon-login.svg" class="icon icon-login" />
				<span>로그인</span>
			</a>
			<a href="#" class="mobile-menu-link">
				<img src="./assets/images/icon/icon-sitemap.svg" class="icon icon-sitemap" />
				<span>사이트맵</span>
			</a>
		</div>
	</div>

	<!-- 모바일 메뉴 콘텐츠 -->
	<div class="mobile-menu-content">
		<!-- 1depth 바 (좌측 고정) -->
		<div class="mobile-menu-depth-bar">
			{
				menuCategories.map((category, index) => (
					<button
						type="button"
						class={`depth-bar-item ${index === 0 ? 'selected' : ''}`}
						data-category={category}
						data-index={index}
					>
						{category}
					</button>
				))
			}
		</div>

		<!-- 2-3depth 메뉴 영역 (우측) -->
		<div class="mobile-menu-detail">
			{
				menuCategories.map((category, categoryIndex) => (
					<div class={`menu-detail-content ${categoryIndex === 0 ? 'active' : ''}`} data-content={category}>
						{menuData[category]?.map((menu, menuIndex) => (
							<div class="menu-section">
								<div class="menu-section-title">
									<h3>{menu.title}</h3>
								</div>

								<div class="menu-section-items">
									{menu.children?.map((child, childIndex) => (
										<div class="menu-item-group">
											{child.children ? (
												<button
													type="button"
													class={`menu-item-toggle ${menuIndex === 0 && childIndex === 0 ? 'selected expanded' : ''}`}
													data-toggle={`${categoryIndex}-${menuIndex}-${childIndex}`}
												>
													<span>{child.title}</span>
													{/* 외부 링크인 경우 외부 링크 아이콘, 아니면 화살표 아이콘 */}
													{child.isExternal ? (
														<img
															src="./assets/images/icon/icon-external-link.svg"
															class="icon icon-external-link"
															alt="외부 링크"
														/>
													) : (
														<img src="./assets/images/icon/icon-arrow-down.svg" class="icon icon-arrow-down" />
													)}
												</button>
											) : (
												<a
													href={child.url}
													class="menu-item-link"
													{...(child.isExternal && { target: '_blank', rel: 'noopener noreferrer' })}
												>
													<span>{child.title}</span>
													{/* 외부 링크 아이콘 표시 */}
													{child.isExternal && (
														<img
															src="./assets/images/icon/icon-external-link.svg"
															class="icon icon-external-link"
															alt="외부 링크"
														/>
													)}
												</a>
											)}

											{/* 3depth 서브메뉴 - 외부 링크 지원 */}
											{child.children && (
												<div
													class={`menu-submenu ${menuIndex === 0 && childIndex === 0 ? 'active' : ''}`}
													data-submenu={`${categoryIndex}-${menuIndex}-${childIndex}`}
												>
													{child.children.map(subChild => (
														<a
															href={subChild.url}
															class="menu-submenu-link"
															{...(subChild.isExternal && { target: '_blank', rel: 'noopener noreferrer' })}
														>
															<span class="bullet" />
															<span>{subChild.title}</span>
															{/* 3depth에서도 외부 링크 아이콘 표시 */}
															{subChild.isExternal && (
																<img
																	src="./assets/images/icon/icon-external-link.svg"
																	class="icon icon-external-link"
																	alt="외부 링크"
																/>
															)}
														</a>
													))}
												</div>
											)}
										</div>
									))}
								</div>
							</div>
						))}
					</div>
				))
			}
		</div>
	</div>

	<!-- 유틸리티 그룹 (하단) -->
</div>

<!-- 모바일 메뉴 토글 버튼 -->
<button type="button" class="mobile-menu-trigger" id="mobileMenuTrigger" aria-label="메뉴 열기">
	<span class="mobile-menu-trigger-bar"></span>
	<span class="mobile-menu-trigger-bar"></span>
	<span class="mobile-menu-trigger-bar"></span>
</button>
