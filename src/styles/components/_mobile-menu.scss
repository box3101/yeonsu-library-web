@use '../abstracts' as *;
@use '../variables/colors' as *;

// 모바일 메뉴 변수
:root {
	--mobile-menu-width: #{to-rem(320)};
	--mobile-menu-header-height: #{to-rem(60)};
	--mobile-menu-z-index: 9999;
	--mobile-menu-overlay-z-index: 9998;
}

// 모바일 메뉴 트리거 버튼 (햄버거 메뉴)
.mobile-menu-trigger {
	display: none;
	flex-direction: column;
	justify-content: space-between;
	align-items: center;
	width: to-rem(40);
	height: to-rem(32);
	background: none;
	border: none;
	cursor: pointer;
	padding: to-rem(8);

	@include mobile {
		display: flex;
	}

	&-bar {
		width: 100%;
		height: to-rem(2);
		background: #374151;
		border-radius: to-rem(1);
		transition: all 0.3s ease;
		transform-origin: center;
	}
	// 메뉴 열린 상태 애니메이션
	&.active {
		.mobile-menu-trigger-bar {
			&:nth-child(1) {
				transform: rotate(45deg) translate(0, to-rem(7));
			}

			&:nth-child(2) {
				opacity: 0;
				transform: scaleX(0);
			}

			&:nth-child(3) {
				transform: rotate(-45deg) translate(0, to-rem(-7));
			}
		}
	}
}

// 모바일 메뉴 오버레이
.mobile-menu-overlay {
	position: fixed;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	background: rgba(0, 0, 0, 0.5);
	z-index: var(--mobile-menu-overlay-z-index);
	opacity: 0;
	visibility: hidden;
	transition: all 0.3s ease;

	&.active {
		opacity: 1;
		visibility: visible;
	}
}

// 모바일 메뉴 컨테이너
.mobile-menu {
	position: fixed;
	top: 0;
	right: 0;
	width: var(--mobile-menu-width);
	height: 100vh;
	background: #ffffff;
	z-index: var(--mobile-menu-z-index);
	transform: translateX(100%);
	transition: transform 0.3s ease;
	@include flex(column, flex-start, stretch);
	box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);

	&.active {
		transform: translateX(0);
	}

	// 모바일 메뉴 헤더
	&-header {
		padding: to-rem(20);
		background: $gray-50;
		border-bottom: 1px solid $gray-200;
		flex-shrink: 0;
		@include flex(column, flex-start, stretch);
		gap: to-rem(4);
	}

	// 유틸리티 영역 (닫기 버튼)
	&-utility {
		@include flex(row, flex-end, center);
		width: 100%;
	}

	&-title {
		@include font(to-rem(18), 700, $gray-900);
		margin: 0;
	}

	&-close {
		@include flex(row, center, center);
		width: to-rem(40);
		height: to-rem(40);
		background: transparent;
		border: none;
		cursor: pointer;
		border-radius: to-rem(8);
		color: $gray-600;
		transition: all 0.2s ease;

		&:hover {
			background: $gray-100;
			color: $gray-900;
		}
	}

	// 유틸리티 링크 영역 (회원가입, 로그인, English, 사이트맵)
	&-links {
		display: grid;
		grid-template-columns: repeat(3, 1fr);
		gap: 8px;
		width: 100%;
	}

	&-link {
		@include flex(row, center, center);
		gap: 6px;
		padding: 12px 12px;
		background: $white;
		border: 1px solid $gray-200;
		border-radius: 8px;
		text-decoration: none;
		transition: all 0.2s ease;

		.icon {
			width: 20px;
			height: 20px;
			flex-shrink: 0;
		}

		span {
			@include font(15px, 500, $gray-700);
			white-space: nowrap;
		}

		&:hover {
			background: $gray-50;
			border-color: $primary-color;

			span {
				color: $primary-color;
			}
		}

		&:active {
			transform: scale(0.98);
		}
	}

	// 모바일 메뉴 콘텐츠
	&-content {
		flex: 1;
		overflow-y: auto;
	}
}

// 모바일 네비게이션
.mobile-nav {
	&-section {
		border-bottom: 1px solid $gray-100;

		&:last-child {
			border-bottom: none;
		}
	}

	&-item {
		position: relative;

		// 1depth 스타일
		&[data-level='1'] {
			> .mobile-nav-toggle,
			> .mobile-nav-link {
				padding: to-rem(16) to-rem(20);
				@include font(to-rem(16), 700, $gray-900);
				background: #ffffff;
				border-bottom: 1px solid $gray-100;

				&:hover {
					background: $gray-50;
				}
			}
		}

		// 2depth 스타일
		&[data-level='2'] {
			> .mobile-nav-toggle,
			> .mobile-nav-link {
				padding: to-rem(12) to-rem(20) to-rem(12) to-rem(40);
				@include font(to-rem(15), 500, $gray-800);
				background: $gray-25;

				&:hover {
					background: $gray-50;
				}
			}
		}

		// 3depth 스타일
		&[data-level='3'] {
			> .mobile-nav-link {
				padding: to-rem(10) to-rem(20) to-rem(10) to-rem(60);
				@include font(to-rem(14), 400, $gray-700);
				background: #ffffff;
				position: relative;

				&:hover {
					background: $gray-25;
				}

				&.selected {
					background: $primary-50;
					color: $primary-color;
					font-weight: 600;

					&::before {
						content: '';
						position: absolute;
						left: to-rem(48);
						top: 50%;
						transform: translateY(-50%);
						width: to-rem(4);
						height: to-rem(4);
						background: $primary-color;
						border-radius: 50%;
					}
				}

				// 3depth 들여쓰기 bullet
				&:not(.selected)::before {
					content: '';
					position: absolute;
					left: to-rem(48);
					top: 50%;
					transform: translateY(-50%);
					width: to-rem(2);
					height: to-rem(2);
					background: $gray-400;
					border-radius: 50%;
				}
			}
		}
	}

	&-toggle {
		@include flex(row, space-between, center);
		width: 100%;
		background: transparent;
		border: none;
		cursor: pointer;
		text-align: left;
		transition: all 0.2s ease;

		&[aria-expanded='true'] {
			.mobile-nav-arrow {
				transform: rotate(180deg);
			}
		}
	}

	&-link {
		@include flex(row, flex-start, center);
		width: 100%;
		text-decoration: none;
		transition: all 0.2s ease;
	}

	&-text {
		flex: 1;
		text-align: left;
	}

	&-arrow {
		color: $gray-500;
		transition: transform 0.2s ease;
		margin-left: to-rem(8);
	}

	// 서브메뉴 컨테이너
	&-submenu {
		max-height: 0;
		overflow: hidden;
		transition: max-height 0.3s ease;

		&.expanded {
			max-height: to-rem(1000); // 충분히 큰 값
		}

		// 3depth 서브메뉴는 배경색 구분
		&[data-level='3'] {
			background: $gray-25;
		}
	}

	// 서브카테고리 (특별한 경우용)
	&-subcategory {
		padding: to-rem(8) 0;

		&-title {
			@include font(to-rem(13), 600, $gray-600);
			padding: to-rem(8) to-rem(20) to-rem(4) to-rem(40);
			margin: 0;
			text-transform: uppercase;
			letter-spacing: 0.5px;
		}
	}
}

// 반응형 처리
@include mobile {
	.mobile-menu {
		width: 100vw;
	}
}

// 접근성 및 애니메이션 최적화
@media (prefers-reduced-motion: reduce) {
	.mobile-menu,
	.mobile-menu-overlay,
	.mobile-menu-trigger-bar,
	.mobile-nav-arrow,
	.mobile-nav-submenu {
		transition: none;
	}
}

// 스크롤바 스타일링 (webkit 브라우저)
.mobile-menu-content {
	&::-webkit-scrollbar {
		width: to-rem(4);
	}

	&::-webkit-scrollbar-track {
		background: $gray-100;
	}

	&::-webkit-scrollbar-thumb {
		background: $gray-300;
		border-radius: to-rem(2);

		&:hover {
			background: $gray-400;
		}
	}
}

// body 스크롤 방지 클래스
.mobile-menu-open {
	overflow: hidden;
	height: 100vh;
}
